From a893bb42dfbb1d90ff7b151f3dea4ac67ac7c7f1 Mon Sep 17 00:00:00 2001
From: Xavier Chapron <xavier.chapron@ledger.fr>
Date: Mon, 8 Aug 2022 10:02:31 +0200
Subject: [PATCH 2/4] lib_stusb_impl: u2f_impl.c: Remove not necessary anymore
 length check work around

---
 lib_stusb_impl/u2f_impl.c | 10 +---------
 1 file changed, 1 insertion(+), 9 deletions(-)

diff --git a/lib_stusb_impl/u2f_impl.c b/lib_stusb_impl/u2f_impl.c
index b4a948f..4bc24cc 100644
--- a/lib_stusb_impl/u2f_impl.c
+++ b/lib_stusb_impl/u2f_impl.c
@@ -242,15 +242,7 @@ void u2f_handle_cmd_msg(u2f_service_t *service, uint8_t *buffer,
     if (dataLength == (uint16_t)(length - 9) || dataLength == (uint16_t)(length - 7)) {
         // Le is optional
         // nominal case from the specification
-    }
-    // circumvent google chrome extended length encoding done on the last byte only (module 256) but all data being transferred
-    else if (dataLength == (uint16_t)(length - 9)%256) {
-        dataLength = length - 9;
-    }
-    else if (dataLength == (uint16_t)(length - 7)%256) {
-        dataLength = length - 7;
-    }    
-    else { 
+    } else {
         // invalid size
         u2f_message_reply(service, U2F_CMD_MSG,
                   (uint8_t *)SW_WRONG_LENGTH,
-- 
2.25.1

